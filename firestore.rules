rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Scores collection - Skor kayıtları
    match /scores/{scoreId} {
      // Okuma: Herkes okuyabilir (leaderboard için)
      allow read: if true;
      
      // Yazma: Sadece giriş yapmış kullanıcılar yazabilir
      // Ve sadece kendi user ID'leri ile kayıt oluşturabilir
      allow create: if request.auth != null 
                    && request.resource.data.userId == request.auth.uid
                    && request.resource.data.score is number
                    && request.resource.data.score >= 0
                    && request.resource.data.score <= 100000
                    && request.resource.data.userName is string
                    && request.resource.data.userName.size() > 0
                    && request.resource.data.userName.size() <= 50
                    && request.resource.data.mode in ['fillBlank', 'multipleChoice', 'matching']
                    && request.resource.data.correct is number
                    && request.resource.data.total is number
                    && request.resource.data.timestamp is number;
      
      // Güncelleme ve silme: Kimse yapamaz (skorlar değiştirilemez)
      allow update, delete: if false;
    }
    
    // Diğer tüm collection'lar: Erişim yok
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
